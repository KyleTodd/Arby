<!DOCTYPE html>
<html>
    <head>
        <title>ARBY - Arbitage Calculator </title>
        <link rel="shortcut icon" href="arbyico.ico" />
        <link  rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    </head>
    
    
    <body>
        
        

        <div class="oddsTableDiv" id="showData">
            <div class="logotitle">
            <img src="/arbylogo.png" class="logo">
            </div>
            <div class="sport_choices">
                <div class="heading"></div>
                <div class="buttons">
    
                    <button onclick="getOdds('tennis_wta_aus_open_singles')" class="btn btn-light btn-sm"> Womens Tennis</button>
                    <button onclick="getOdds('aussierules_afl')" class="btn btn-light btn-sm"> Mens AFL </button>
                    <button onclick="getOdds('basketball_nba')" class="btn btn-light btn-sm"> Mens NBA </button>
                    <button onclick="getOdds('cricket_big_bash')" class="btn btn-light btn-sm"> Cricket Big Bash </button>
                    <!-- <button onclick="getOdds('baseball_mlb_world_series_winner')" class="btn btn-light btn-sm"> Baseball MLB </button>
                    <button onclick="getOdds('americanfootball_nfl_super_bowl_winner')" class="btn btn-light btn-sm"> NFL Superbowl </button>
                    <button onclick="getOdds('golf_masters_tournament_winner')" class="btn btn-light btn-sm"> Golf Tournament </button>
                    <button onclick="getOdds('icehockey_nhl')" class="btn btn-light btn-sm"> Ice Hockey NHL </button> -->
    
                </div>
            </div>
            <table  class="table table-bordered table-dark table-hover">

            <thead class="thead-dark">
            <tr>
                <th>Away Team</th>
                <th>Away Broker</th>
                <th>Away Price</th>
                <th>Home Team</th>
                <th>Home Broker</th>
                <th>Home Price</th>
                <th>Ratio</th>
                <th>Opportunity</th>
            </tr>
            </thead>
            <tbody id="oddsTable">

            </tbody>
            </table>
        </div>
    </body>
</html>

<script>
var allOdds = [];
var rowCount = document.getElementById('oddsTable').rows.length;

function returnOdds(sport){
    let request = new XMLHttpRequest();
    request.open("GET", "http://localhost:5000/sports?type="+sport);
    request.send();
   
    request.onload = () => {
        if (request.status = 200){
            allOdds.push(JSON.parse(request.response));
            createTable(allOdds[0][0].length-1)
            allOdds = [];
        } else {
            console.log(`error ${request.status} ${request.statusText}`)
        }
    }
    return allOdds;
}

function createTable(tableRowAmount) {
    rowCount = document.getElementById('oddsTable').rows.length;

    console.log(rowCount);
    while (rowCount > 0) {
    document.getElementById("oddsTable").deleteRow(-1);
    rowCount = document.getElementById('oddsTable').rows.length;
    console.log('Trying to remove row');
    }

    i = 0;
    while (i <= tableRowAmount){
    var table = document.getElementById("oddsTable");
    var row = table.insertRow(-1);
    var cell1 = row.insertCell(0);
    cell1.innerHTML = allOdds[0][0][i]['awayTeam'];
    var cell2 = row.insertCell(1);
    cell2.innerHTML = allOdds[0][0][i]['awayBroker'];
    var cell3 = row.insertCell(2);
    cell3.innerHTML = allOdds[0][0][i]['awayPrice'];
    var cell4 = row.insertCell(3);
    cell4.innerHTML = allOdds[0][0][i]['homeTeam'];
    var cell5 = row.insertCell(4);
    cell5.innerHTML = allOdds[0][0][i]['homeBroker'];
    var cell6 = row.insertCell(5);
    cell6.innerHTML = allOdds[0][0][i]['homePrice'];
    var cell7 = row.insertCell(6);
    cell7.innerHTML = allOdds[0][0][i]['combinedRatio'];
    var cell8 = row.insertCell(7);
    cell8.innerHTML = allOdds[0][0][i]['arbOpAvailable'];
    i++
    }

    
}

function getOdds(sport){
    
    

    const oddsObject = returnOdds(sport);
    console.log(oddsObject);


    

}



function returnW(){
    let requestW = new XMLHttpRequest();
    requestW.open("GET", "https://api.open-meteo.com/v1/forecast?latitude=-33.87&longitude=151.21&hourly=temperature_2m");
    requestW.send();
    var allW = [];
    requestW.onload = () => {
        if (requestW.status = 200){
           allW.push(JSON.parse(requestW.response));
           document.write(Object.keys(allW).length);
           return Object.keys(allW).length;
        } else {
            console.log(`error ${requestW.status} ${requestW.statusText}`)
        }
    }
    
}

function getW(){
    var WObject = returnW();
    console.log(WObject);

    

}
</script>

